
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../01.Install_deb_files/">
      
      
        <link rel="next" href="../03.Configure_aptly/">
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>build private package mirrors with aptly - Pengfei Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#install-aptly" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Pengfei Documentation" class="md-header__button md-logo" aria-label="Pengfei Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pengfei Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              build private package mirrors with aptly
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Pengfei Documentation" class="md-nav__button md-logo" aria-label="Pengfei Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Pengfei Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    admin_sys
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    admin_sys
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/debian_admin_cheat_sheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    debian_admin_cheat_sheet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/Cron_jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cron_jobs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/Systemd%28serviced%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    systemd(serviced) in linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/Time_Synchronization_in_Debian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    time_synchronization_in_debian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    db_management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    db_management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    mariadb
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    mariadb
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../db_management/mariadb/Installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../db_management/mariadb/Management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    postgres
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    postgres
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../db_management/postgres/Install_postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    installation bare_metal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../db_management/postgres/Install_postgres_via_helm_chart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    installation on k8s
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    fs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    fs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" >
        
          
          <label class="md-nav__link" for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Minio
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Minio
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fs/Minio/01.Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fs/Minio/02.Install_minio_bare_metal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    installation bare_metal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fs/Minio/03.Install_and_config_minio_client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install_and config minio client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fs/Minio/04.Minio_installation_details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    minio_installation_details
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    NFS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    NFS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fs/NFS/Install_nfs_server_client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Rook_Ceph
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Rook_Ceph
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fs/Rook_Ceph/rook_ceph_Installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    rook_ceph_installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fs/Rook_Ceph/Rook_Ceph_toolbox_and_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    os_setup
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    os_setup
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.Lang_support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    server language support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Add_debian_backports_repo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    debian backports repo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03.Remote_Desktop_access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    debian server rdp access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05.Debian_security_update_automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    debian server security update automation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06.Accept_private_ca_certificate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    debian server accept private ca cert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../07.Setup_shared_folder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure a shared folder in debian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../08.Debian_upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migrate debian 11 to 13
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Install_configure_Postfix_to_sendmail/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use postfix to sendmail
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_9" >
        
          
          <label class="md-nav__link" for="__nav_2_4_9" id="__nav_2_4_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    auto_config
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    auto_config
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_9_1" >
        
          
          <label class="md-nav__link" for="__nav_2_4_9_1" id="__nav_2_4_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ansible
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_4_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    ansible
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../auto_config/ansible/Install_ansible_debian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install_ansible
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../auto_config/ansible/ansible_roles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ansible roles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_10" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_10" id="__nav_2_4_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    package_management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    package_management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01.Install_deb_files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install package via deb files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    build private package mirrors with aptly
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    build private package mirrors with aptly
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-system-package-repository-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. System Package repository Introduction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. System Package repository Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-repo-list-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Repo list format
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1 Repo list format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-url" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository URL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Distribution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-add-a-repo-by-using-the-sourceslist-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Add a repo by using the sources.list file
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-installing-aptly" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Installing Aptly
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Installing Aptly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-install-aptly-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Install Aptly dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-install-aptly" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Install Aptly
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-create-gpg-pair" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Create GPG pair
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 Create GPG pair">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-the-passphrase-of-the-secret-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify the passphrase of the secret key
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-repo-mirrors" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Creating repo mirrors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creating repo mirrors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-the-filter-flag" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 The filter flag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-check-the-created-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Check the created mirror
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-edit-existing-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Edit existing mirror
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-updatesynchronize-the-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 Update(Synchronize) the mirror
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-use-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        4 Use snapshots
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 Use snapshots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-create-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Create snapshots
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-merging-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Merging snapshots
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-publish-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        5 Publish Repository
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 Publish Repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-check-published-snapshot-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Check published snapshot dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-serve-the-published-via-a-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Serve the published via a web server
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-using-the-private-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Using the private Repository
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Using the private Repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-prepare-the-gpg-gnu-privacy-guard-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Prepare the GPG (GNU privacy guard) key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-copy-the-public-key-to-target-machine" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Copy the public key to target machine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 Copy the public key to target machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solution-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution 1:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution 2:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-apt-source-repo-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change apt source repo list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-upgrading-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Upgrading repository
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-serve-the-packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Serve the packages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-cron" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Cron
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Cron">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-aptly-release-cron-job" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Aptly release cron job
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 Aptly release cron job">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#911-script-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1.1 Script configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#912-handling-new-emerging-mirrors" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1.2 Handling New emerging mirrors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1.2 Handling New emerging mirrors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-mirror-for-k8s" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Mirror for k8s
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-mirror-for-docker" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Mirror for docker
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-cron-job-for-cleaning-old-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Cron job for cleaning old release
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-repo-mirror-for-k8s" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extra repo mirror for k8s
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extra repo mirror for k8s">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k8s-main" class="md-nav__link">
    <span class="md-ellipsis">
      
        k8s-main
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerdio" class="md-nav__link">
    <span class="md-ellipsis">
      
        containerd.io
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03.Configure_aptly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    config aptly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02.Use_private_repo_in_debian.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    use private package repo in debian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_11" >
        
          
          <label class="md-nav__link" for="__nav_2_4_11" id="__nav_2_4_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/01.Configure_ssh_local_account/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure_ssh_local_account
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/02.Configure_ssh_pam_ldap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure_ssh_pam_ldap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/03.Configure_ssh_sssd_ldap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure ssh sssd ldap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/04.Configure_ssh_pam_sssd_ad_en/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure_ssh_sssd_ad
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/05.Static_uid_gid_integration_in_sssd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Static_uid_gid_integration_in_sssd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/06.Configure_ssh_sssd_kerberos_linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure_ssh_sssd_kerberos_linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    other_services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    other_services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_services/build_openssl_tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build_openssl_tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_services/install_gitlab_ce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install_gitlab_ce
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_services/install_vscode_server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install_vscode_server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_4" >
        
          
          <label class="md-nav__link" for="__nav_2_5_4" id="__nav_2_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nginx
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_services/Nginx/01.Install_Nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_services/Nginx/02.Enable_https_resolution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Enable_https_and_auto_redirect
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_services/Nginx/03.Use_Nginx_as_Http_load_balancer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use_nginx_as_load_balancer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    container
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    container
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Containerd
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Containerd
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Containerd/01.Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Containerd/02.Install_config_containerd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Docker and Docker compose
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Docker and Docker compose
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Docker/01.Install_docker_dockerCompose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Docker/02.Use_docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Docker/03.Use_docker_compose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use docker compose
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Helm_chart_registry/01.Deploy_a_helm_chart_registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    helm chart registry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    container image registry
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    container image registry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Docker
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/Docker/02.Docker_engine_installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker engine installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/Docker/03.Docker_common_commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker common commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    harbor
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    harbor
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/harbor/01.Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/harbor/02.Harbor_installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harbor installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/harbor/03.Harbor_helm_chart_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harbor helm chart management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/harbor/Harbor_export_import_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harbor export import image
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/Introduction_of_private_image_registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction of private image registry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/04.Use_private_image_registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure container runtime to use private image registry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/Image_secu_inspection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image_secu_inspection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/Image_registry/Trivy_image_scanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image_vulnerability_scanner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    k8s
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    k8s
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_1" >
        
          
          <label class="md-nav__link" for="__nav_3_5_1" id="__nav_3_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    deploy_k8s_with_kubeadm
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    deploy_k8s_with_kubeadm
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/deploy_k8s_with_kubeadm/01.Introduction_of_Kubeadm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction of kubeadm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/deploy_k8s_with_kubeadm/02.Deploy_k8s_cluster_online/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploy k8s with kubeadm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/deploy_k8s_with_kubeadm/03.K8s_cluster_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manage k8s with kubeadm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/deploy_k8s_with_kubeadm/04.Post_k8s_cluster_installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Post installation config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_2" >
        
          
          <label class="md-nav__link" for="__nav_3_5_2" id="__nav_3_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    deploy_k8s_offline
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    deploy_k8s_offline
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/deploy_k8s_offline/02.Prepare_env_for_installing_k8s_offline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prepare server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/deploy_k8s_offline/03.Install_k8s_offline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install k8s offline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_3" >
        
          
          <label class="md-nav__link" for="__nav_3_5_3" id="__nav_3_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    k8s_client_setup
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    k8s_client_setup
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/k8s_client_setup/01.Install_kubectl_and_helm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install kubectl and helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/k8s_client_setup/02.Helm_introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction of helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/k8s_client_setup/03.Helm_use_private_repo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure helm client to use private repo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_4" >
        
          
          <label class="md-nav__link" for="__nav_3_5_4" id="__nav_3_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    k8s_security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    k8s_security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/k8s_security/01.K8s_security_best_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    k8s security best practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/k8s_security/06.k8s_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    k8s network security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/01.Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction of k8s
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/04.Managing_k8s_certificate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Managing k8s certificate
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/05.k8s_cluster_supervision/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K8s_cluster_supervision
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/Debug_application_in_cluster_k8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debug_deployed_app_in_k8s
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../container/k8s/k8s_cluster_upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    k8s_cluster_upgrade
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    data_management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    data_management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_management/tuning.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_management/faq.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    dev_ops
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    dev_ops
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../devops/install.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../devops/config.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    hadoop
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    hadoop
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../hadoop/Integrate_kerberos_in_hadoop_cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integrate kerberos in hadoop cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Onyxia
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Onyxia
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Onyxia/03.Install_onyxia/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install onyxia
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    python
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    python
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    pypi_mirror
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    pypi_mirror
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/pypi_server/01.introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/04.Install_python_debian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install python interpreter in debian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Kerberos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kerberos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/kerberos/01.Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01.Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/kerberos/02.Install_kerberos_server_client_for_debian_server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02.Install_kerberos_client_server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/kerberos/03.Configure_kerberos_to_use_ldap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03.Configure_kerberos_to_use_ldap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/kerberos/04.Install_kerberos_server_client_for_windows_server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04.Install_kerberos_server_client_for_windows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/kerberos/05.Configure_sssd_to_use_static_uid_gid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05.Configure_sssd_to_use_static_uid_gid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/kerberos/Keytab_introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06.Keytab_introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    keycloak
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    keycloak
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/keycloak/Install_keycloak/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install_keycloak
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3" id="__nav_9_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ldap
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    ldap
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security/ldap/01.install_ldap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install_ldap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-system-package-repository-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. System Package repository Introduction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. System Package repository Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-repo-list-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Repo list format
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1 Repo list format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-url" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository URL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Distribution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-add-a-repo-by-using-the-sourceslist-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Add a repo by using the sources.list file
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-installing-aptly" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Installing Aptly
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Installing Aptly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-install-aptly-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Install Aptly dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-install-aptly" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Install Aptly
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-create-gpg-pair" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Create GPG pair
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 Create GPG pair">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-the-passphrase-of-the-secret-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify the passphrase of the secret key
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-repo-mirrors" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Creating repo mirrors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creating repo mirrors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-the-filter-flag" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 The filter flag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-check-the-created-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Check the created mirror
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-edit-existing-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Edit existing mirror
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-updatesynchronize-the-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 Update(Synchronize) the mirror
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-use-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        4 Use snapshots
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 Use snapshots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-create-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Create snapshots
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-merging-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Merging snapshots
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-publish-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        5 Publish Repository
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 Publish Repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-check-published-snapshot-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Check published snapshot dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-serve-the-published-via-a-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Serve the published via a web server
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-using-the-private-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Using the private Repository
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Using the private Repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-prepare-the-gpg-gnu-privacy-guard-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Prepare the GPG (GNU privacy guard) key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-copy-the-public-key-to-target-machine" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Copy the public key to target machine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 Copy the public key to target machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solution-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution 1:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution 2:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-apt-source-repo-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change apt source repo list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-upgrading-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Upgrading repository
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-serve-the-packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Serve the packages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-cron" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Cron
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Cron">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-aptly-release-cron-job" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Aptly release cron job
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 Aptly release cron job">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#911-script-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1.1 Script configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#912-handling-new-emerging-mirrors" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1.2 Handling New emerging mirrors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1.2 Handling New emerging mirrors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-mirror-for-k8s" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Mirror for k8s
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-mirror-for-docker" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Mirror for docker
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-cron-job-for-cleaning-old-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Cron job for cleaning old release
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-repo-mirror-for-k8s" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extra repo mirror for k8s
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extra repo mirror for k8s">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k8s-main" class="md-nav__link">
    <span class="md-ellipsis">
      
        k8s-main
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerdio" class="md-nav__link">
    <span class="md-ellipsis">
      
        containerd.io
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="install-aptly">Install aptly<a class="headerlink" href="#install-aptly" title="Permanent link">&para;</a></h1>
<h2 id="1-system-package-repository-introduction">1. System Package repository Introduction<a class="headerlink" href="#1-system-package-repository-introduction" title="Permanent link">&para;</a></h2>
<p>Before we start, we need to understand what is a linux system package repository. In Linux, the <code>system package repository</code> is a storage location hosted on remote servers from which the system retrieves and installs software and updates. </p>
<p>Each linux distribution has its own repository and package manager. For example, for <code>Red Hat</code> distribution, they uses <code>yum/dnf</code> as package manager,  the default repo url is shown below</p>
<div class="codehilite"><pre><span></span><code>[base]
name=CentOS-7 - Base
mirrorlist=http://mirrorlist.centos.org/?release=7&amp;arch=$basearch&amp;repo=os&amp;infra=$infra
#baseurl=http://mirror.centos.org/centos/7/os/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

#released updates
[updates]
name=CentOS-7 - Updates
mirrorlist=http://mirrorlist.centos.org/?release=7&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra
#baseurl=http://mirror.centos.org/centos/7/updates/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

#additional packages that may be useful
[extras]
name=CentOS-7 - Extras
mirrorlist=http://mirrorlist.centos.org/?release=7&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra
#baseurl=http://mirror.centos.org/centos/7/extras/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

#additional packages that extend functionality of existing packages
[centosplus]
name=CentOS-7 - Plus
mirrorlist=http://mirrorlist.centos.org/?release=7&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra
#baseurl=http://mirror.centos.org/centos/7/centosplus/$basearch/
gpgcheck=1
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
</code></pre></div>

<p>For debian distribution, it uses <code>apt-get/apt</code> as package manager, and the default/standard repo url are:</p>
<div class="codehilite"><pre><span></span><code>deb http://deb.debian.org/debian bullseye main
deb-src http://deb.debian.org/debian bullseye main
deb http://security.debian.org/debian-security bullseye-security main contrib
deb-src http://security.debian.org/debian-security bullseye-security main contrib
deb http://deb.debian.org/debian/ bullseye-updates main contrib
deb-src http://deb.debian.org/debian/ bullseye-updates main contrib
</code></pre></div>

<p>You can find the repo list are in <code>/etc/apt/sources.lits</code> file and files under the <code>/etc/apt/sources.list.d</code> directory.</p>
<h3 id="11-repo-list-format">1.1 Repo list format<a class="headerlink" href="#11-repo-list-format" title="Permanent link">&para;</a></h3>
<p>Below figure shows the format of each row in the source list.</p>
<p><img alt="images/deb_repo_list_format.webp" src="../../images/deb_repo_list_format.webp" /></p>
<h4 id="type">Type<a class="headerlink" href="#type" title="Permanent link">&para;</a></h4>
<p>The term <code>deb</code> indicates that it is the repository of binaries, which are pre-compiled fiels. The term <code>deb-src</code> indicates that it is the repository of packages in source file format, which requires <code>compilation</code> in order to use it in the system.</p>
<h4 id="repository-url">Repository URL<a class="headerlink" href="#repository-url" title="Permanent link">&para;</a></h4>
<p>The URL (HTTP, HTTPS, or FTP) represents the location of the repository from which you can download the packages.</p>
<h4 id="distribution">Distribution<a class="headerlink" href="#distribution" title="Permanent link">&para;</a></h4>
<p>The next term is the short codename (i.e. Buster, Wheezy, Lenny, Jessie, Bullseye, etc.) of the release of your current system. The repo server may support multiple release, so we need to specify which release we want.</p>
<h4 id="component">Component<a class="headerlink" href="#component" title="Permanent link">&para;</a></h4>
<p>The final term represents the <code>categories of the Debian package</code>. The available categories of the Debian distribution are :
- main: This category contains packages that are released under a free license (BSD, GPL, etc.) and that meet the DFSG (Debian Free Software Guidelines). These packages also contain the source code within them, which can be modified and redistributed.
- contrib: This category contains the packages that meet the DFSG (Debian Free Software Guidelines. The packages in the Contrib category are open-source packages, but depend on non-free packages to work.
- non-free: This category contains the packages that do not meet the DFSG (Debian Free Software Guidelines). These packages have some strict license conditions that restrict the usage and redistribution of the software.</p>
<h3 id="12-add-a-repo-by-using-the-sourceslist-file">1.2 Add a repo by using the sources.list file<a class="headerlink" href="#12-add-a-repo-by-using-the-sourceslist-file" title="Permanent link">&para;</a></h3>
<p>In below example, we add the virtualbox repo to the repo list.
You can follow below steps to add a custom repository:</p>
<ol>
<li>Download and import GPG keys of vbox. You can use below command. You may need to install gpg first</li>
</ol>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>-O-<span class="w"> </span>-q<span class="w"> </span>https://www.virtualbox.org/download/oracle_vbox_2016.asc<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmour<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/oracle_vbox_2016.gpg
</code></pre></div>

<ol>
<li>Open the <code>/etc/apt/sources.list</code> file and add below line at the end of the file. <code>deb [arch=amd64 signed-by=/usr/share/keyrings/oracle_vbox_2016.gpg] http://download.virtualbox.org/virtualbox/debian bullseye contrib</code>. Or you can run below command</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/oracle_vbox_2016.gpg] http://download.virtualbox.org/virtualbox/debian bullseye contrib&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/virtualbox.list
</code></pre></div>

<ol>
<li>Save and close</li>
<li>Update apt (sudo apt update)</li>
<li>Search the virtual box package with <code>apt search virtualbox</code>. You should see below output</li>
</ol>
<div class="codehilite"><pre><span></span><code>Sorting...<span class="w"> </span>Done
Full<span class="w"> </span>Text<span class="w"> </span>Search...<span class="w"> </span>Done
libvirt-daemon-driver-vbox/stable<span class="w"> </span><span class="m">7</span>.0.0-3<span class="w"> </span>amd64
<span class="w">  </span>Virtualization<span class="w"> </span>daemon<span class="w"> </span>VirtualBox<span class="w"> </span>connection<span class="w"> </span>driver

virtualbox-6.1/unknown<span class="w"> </span><span class="m">6</span>.1.42-155177~Debian~bullseye<span class="w"> </span>amd64
<span class="w">  </span>Oracle<span class="w"> </span>VM<span class="w"> </span>VirtualBox

virtualbox-7.0/unknown<span class="w"> </span><span class="m">7</span>.0.6-155176~Debian~bullseye<span class="w"> </span>amd64
<span class="w">  </span>Oracle<span class="w"> </span>VM<span class="w"> </span>VirtualBox
</code></pre></div>

<h2 id="2-installing-aptly">2. Installing Aptly<a class="headerlink" href="#2-installing-aptly" title="Permanent link">&para;</a></h2>
<p>You <strong>must not</strong> run below command with <code>root</code> user. </p>
<h3 id="21-install-aptly-dependencies">2.1 Install Aptly dependencies<a class="headerlink" href="#21-install-aptly-dependencies" title="Permanent link">&para;</a></h3>
<p>Atply requrires below package:
- bzip2: compression
- gnupg: the gnu privacy guard is a complete and free implementation of the OpenPGP standard
- gpgv: gpgv is actually a stripped-down version of gpg which is only able to check signatures.
- xz-utils: is a general-purpose data compression software with a high compression ratio</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>bzip2<span class="w"> </span>gnupg<span class="w"> </span>gpgv
</code></pre></div>

<h3 id="22-install-aptly">2.2 Install Aptly<a class="headerlink" href="#22-install-aptly" title="Permanent link">&para;</a></h3>
<p>The package repo for aptly can be found <a href="http://repo.aptly.info/">here</a></p>
<p>Step1 : Download the public gpg key of Aptly </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># New key per 2022-03-15 !</span>
sudo<span class="w"> </span>apt-key<span class="w"> </span>adv<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>A0546A43624A8331
</code></pre></div>

<p>Step2 : Add aptly repo to sources.list</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># -a means append which is important, without it the original content will be removed</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb http://repo.aptly.info/ squeeze main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/apt/sources.list
</code></pre></div>

<p>Don't worry about <strong>squeeze</strong> part in the repo name. I have tested it, it works for the debian 11 (bullseye).</p>
<p>Step3 : Update repo and install</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>aptly
</code></pre></div>

<p>Step4 : Check your aptly install</p>
<div class="codehilite"><pre><span></span><code>aptly<span class="w"> </span>version

<span class="c1"># you should see below output</span>
aptly<span class="w"> </span>version:<span class="w"> </span><span class="s1">&#39;1.5.0&#39;</span>
</code></pre></div>

<h3 id="23-create-gpg-pair">2.3 Create GPG pair<a class="headerlink" href="#23-create-gpg-pair" title="Permanent link">&para;</a></h3>
<p>We will use a <code>GPG key pair to sign the published repositories</code>. If you don't have one, use below command to generate one.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># call the gpg key gen client</span>
gpg<span class="w"> </span>--full-generate-key

<span class="c1"># it will prompt below lines, just fill it with name, email</span>
Real<span class="w"> </span>name:<span class="w"> </span>casd-debian
Email<span class="w"> </span>address:<span class="w"> </span>service@casd.eu
You<span class="w"> </span>selected<span class="w"> </span>this<span class="w"> </span>USER-ID:
<span class="w">    </span><span class="s2">&quot;casd-onyxia &lt;casd-support@casd.eu&gt;&quot;</span>

Change<span class="w"> </span><span class="o">(</span>N<span class="o">)</span>ame,<span class="w"> </span><span class="o">(</span>E<span class="o">)</span>mail,<span class="w"> </span>or<span class="w"> </span><span class="o">(</span>O<span class="o">)</span>kay/<span class="o">(</span>Q<span class="o">)</span>uit?<span class="w"> </span>O

<span class="c1"># then it will ask you to enter a passphrase to secure the private key</span>
</code></pre></div>

<p>After you entered all the information, a folder <code>.gnupg</code> will be generated in the current folder. For more information about the GPG key management, you can check this <a href="https://fedoraproject.org/wiki/Creating_GPG_Keys">page</a>. Below are some commonly used command</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># list secret keys</span>
gpg<span class="w"> </span>--list-secret-keys

<span class="c1"># list public keys</span>
gpg<span class="w"> </span>--list-keys

<span class="c1"># delet keys, to remove keys you need to delete the secret key first, then the public key</span>
gpg<span class="w"> </span>--delete-secret-key
gpg<span class="w"> </span>--delete-key
</code></pre></div>

<h4 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h4>
<p>The gpg agent is very bugy. And you may receive many error message. The most common solution is to restart the gpg agent by using below command</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># kill the gpg-agent process will trigger the daemon to create a new one</span>
gpgconf<span class="w"> </span>--kill<span class="w"> </span>gpg-agent
</code></pre></div>

<h4 id="verify-the-passphrase-of-the-secret-key">Verify the passphrase of the secret key<a class="headerlink" href="#verify-the-passphrase-of-the-secret-key" title="Permanent link">&para;</a></h4>
<p>The simplest way is to use the change password feature of the secret key. It asks</p>
<div class="codehilite"><pre><span></span><code>gpg<span class="w"> </span>--passwd<span class="w"> </span>&lt;secret-key-id&gt;
</code></pre></div>

<h2 id="3-creating-repo-mirrors">3. Creating repo mirrors<a class="headerlink" href="#3-creating-repo-mirrors" title="Permanent link">&para;</a></h2>
<p>Now we have all the necessary parts to create a local mirror of an official repo. Suppose we need to 
mirror <code>bullseye</code> (current stable 2023) for architecture <code>amd64</code>. Only <code>main</code> component is required and this repository is targeted for servers, not desktops. You can find local debian repo mirror per Country in this <a href="https://www.debian.org/mirror/list">page</a>. In below command, we choose the server in France.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># command 1</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>-filter<span class="o">=</span><span class="s1">&#39;Priority (required) | Priority (important) | Priority (standard)&#39;</span><span class="w"> </span>bullseye-main<span class="w"> </span>http://ftp.fr.debian.org/debian/<span class="w"> </span>bullseye<span class="w"> </span>main
</code></pre></div>

<p>You should see this error <code>ERROR: unable to fetch mirror: verification of detached signature failed: exit status 2</code> when you run above command. So we need to add the default debian keyring as trusted.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># command 2</span>
gpg<span class="w"> </span>--no-default-keyring<span class="w"> </span>--keyring<span class="w"> </span>/usr/share/keyrings/debian-archive-keyring.gpg<span class="w"> </span>--export<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--no-default-keyring<span class="w"> </span>--keyring<span class="w"> </span>trustedkeys.gpg<span class="w"> </span>--import
</code></pre></div>

<p>Now rerun the <code>command 1</code>, you should see below output</p>
<div class="codehilite"><pre><span></span><code>Downloading http://ftp.fr.debian.org/debian/dists/bullseye/InRelease...
Success downloading http://ftp.fr.debian.org/debian/dists/bullseye/InRelease
gpgv: can&#39;t allocate lock for &#39;/home/coder/.gnupg/trustedkeys.gpg&#39;
gpgv: Signature made Sat 17 Dec 2022 10:15:20 AM UTC
gpgv:                using RSA key 0146DC6D4A0B2914BDED34DB648ACFD622F3D138
gpgv: Good signature from &quot;Debian Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;&quot;
gpgv: Signature made Sat 17 Dec 2022 10:15:21 AM UTC
gpgv:                using RSA key A7236886F3CCCAAD148A27F80E98404D386FA1D9
gpgv: Good signature from &quot;Debian Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;&quot;
gpgv: Signature made Sat 17 Dec 2022 10:20:04 AM UTC
gpgv:                using RSA key A4285295FC7B1A81600062A9605C66F00D6C9793
gpgv:                issuer &quot;debian-release@lists.debian.org&quot;
gpgv: Good signature from &quot;Debian Stable Release Key (11/bullseye) &lt;debian-release@lists.debian.org&gt;&quot;

Mirror [bullseye-main]: http://ftp.fr.debian.org/debian/ bullseye successfully added.
You can run &#39;aptly mirror update bullseye-main&#39; to download repository contents.
</code></pre></div>

<h3 id="31-the-filter-flag">3.1 The filter flag<a class="headerlink" href="#31-the-filter-flag" title="Permanent link">&para;</a></h3>
<p>The flag <strong>-filter=</strong> allows us to cut down number of packages to download. First part, <code>Priority (required) | Priority (important) | Priority (standard)</code> is essential base Debian system. </p>
<p>We can also specify individual packages explicitly. For example, with below command, the mirror will  add package such as: nginx, postgresql, etc. </p>
<div class="codehilite"><pre><span></span><code>aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>-filter<span class="o">=</span><span class="s1">&#39;Priority (required) | Priority (important) | Priority (standard) | nginx | postgresql&#39;</span><span class="w"> </span>-filter-with-deps<span class="w"> </span>bullseye-main<span class="w"> </span>http://ftp.fr.debian.org/debian/<span class="w"> </span>bullseye<span class="w"> </span>main

<span class="c1"># we create also mirror for bullseye-updates and bullseye-security </span>
<span class="c1"># you can notice the repo url is the same, but the distribution is `bullseye-updates`</span>
<span class="c1"># and the component is `main` </span>

aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>-filter<span class="o">=</span><span class="s1">&#39;Priority (required) | Priority (important) | Priority (standard) | nginx | postgresql&#39;</span><span class="w"> </span>-filter-with-deps<span class="w"> </span>bullseye-updates<span class="w"> </span>http://ftp.fr.debian.org/debian/<span class="w"> </span>bullseye-updates<span class="w"> </span>main
</code></pre></div>

<p>Flag <strong>-filter-with-deps</strong> instructs <code>aptly</code> to include dependencies of matching packages as well. </p>
<blockquote>
<p>If filter is not specified, all packages would be included in the mirror and that would require more space and download size would be bigger.</p>
</blockquote>
<p>In below example, we will mirror all the package of the debian security repo, because we have 0 filter in it.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># without filter, the mirror will take 20GiB </span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>bullseye-security<span class="w"> </span>http://security.debian.org/debian-security<span class="w"> </span>bullseye-security/updates<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free

<span class="c1"># with filter </span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>-filter<span class="o">=</span><span class="s1">&#39;Priority (required) | Priority (important) | Priority (standard) | nginx | postgresql&#39;</span><span class="w"> </span>-filter-with-deps<span class="w"> </span>bullseye-security<span class="w"> </span>http://security.debian.org/debian-security<span class="w"> </span>bullseye-security/updates<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free
</code></pre></div>

<h3 id="32-check-the-created-mirror">3.2 Check the created mirror<a class="headerlink" href="#32-check-the-created-mirror" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># bullseye-update mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>bullseye-updates<span class="w"> </span>http://ftp.fr.debian.org/debian/<span class="w"> </span>bullseye-updates<span class="w"> </span>main

<span class="c1"># bullseye-security mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>bullseye-security<span class="w"> </span>http://security.debian.org/debian-security<span class="w"> </span>bullseye-security/updates<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free


<span class="c1"># get the full list of existing mirrors</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>list

<span class="c1"># you should see below output</span>
List<span class="w"> </span>of<span class="w"> </span>mirrors:
<span class="w"> </span>*<span class="w"> </span><span class="o">[</span>bullseye-main<span class="o">]</span>:<span class="w"> </span>http://ftp.fr.debian.org/debian/<span class="w"> </span>bullseye

To<span class="w"> </span>get<span class="w"> </span>more<span class="w"> </span>information<span class="w"> </span>about<span class="w"> </span>mirror,<span class="w"> </span>run<span class="w"> </span><span class="sb">`</span>aptly<span class="w"> </span>mirror<span class="w"> </span>show<span class="w"> </span>&lt;name&gt;<span class="sb">`</span>.

<span class="c1"># get the detail of bullseye-main mirror</span>
<span class="w"> </span>aptly<span class="w"> </span>mirror<span class="w"> </span>show<span class="w"> </span>bullseye-main

<span class="c1"># you should see below output</span>
Name:<span class="w"> </span>bullseye-main
Archive<span class="w"> </span>Root<span class="w"> </span>URL:<span class="w"> </span>http://ftp.fr.debian.org/debian/
Distribution:<span class="w"> </span>bullseye
Components:<span class="w"> </span>main
Architectures:<span class="w"> </span>amd64
Download<span class="w"> </span>Sources:<span class="w"> </span>no
Download<span class="w"> </span>.udebs:<span class="w"> </span>no
Filter:<span class="w"> </span>Priority<span class="w"> </span><span class="o">(</span>required<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>Priority<span class="w"> </span><span class="o">(</span>important<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>Priority<span class="w"> </span><span class="o">(</span>standard<span class="o">)</span>
Filter<span class="w"> </span>With<span class="w"> </span>Deps:<span class="w"> </span>no
Last<span class="w"> </span>update:<span class="w"> </span>never

Information<span class="w"> </span>from<span class="w"> </span>release<span class="w"> </span>file:
Acquire-By-Hash:<span class="w"> </span>yes
Architectures:<span class="w"> </span>all<span class="w"> </span>amd64<span class="w"> </span>arm64<span class="w"> </span>armel<span class="w"> </span>armhf<span class="w"> </span>i386<span class="w"> </span>mips64el<span class="w"> </span>mipsel<span class="w"> </span>ppc64el<span class="w"> </span>s390x
Changelogs:<span class="w"> </span>https://metadata.ftp-master.debian.org/changelogs/@CHANGEPATH@_changelog
Codename:<span class="w"> </span>bullseye
Components:<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free
Date:<span class="w"> </span>Sat,<span class="w"> </span><span class="m">17</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">10</span>:14:37<span class="w"> </span>UTC
Description:<span class="w">  </span>Debian<span class="w"> </span><span class="m">11</span>.6<span class="w"> </span>Released<span class="w"> </span><span class="m">17</span><span class="w"> </span>December<span class="w"> </span><span class="m">2022</span>

Label:<span class="w"> </span>Debian
No-Support-For-Architecture-All:<span class="w"> </span>Packages
Origin:<span class="w"> </span>Debian
Suite:<span class="w"> </span>stable
Version:<span class="w"> </span><span class="m">11</span>.6
</code></pre></div>

<h3 id="33-edit-existing-mirror">3.3 Edit existing mirror<a class="headerlink" href="#33-edit-existing-mirror" title="Permanent link">&para;</a></h3>
<p>When you want to modify an existing mirror configuraiton, you need to run below command.
You can find more information <a href="https://www.aptly.info/doc/aptly/mirror/edit/">here</a></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># note with below command, the old filter will be replaced, if you want to append, you need to do it</span>
<span class="c1"># manually </span>
aptly<span class="w"> </span>mirror<span class="w"> </span>edit<span class="w"> </span>-filter<span class="o">=</span><span class="s1">&#39;nginx | postgresql&#39;</span><span class="w"> </span>-filter-with-deps<span class="w"> </span>bullseye-main

<span class="c1"># append example</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>edit<span class="w"> </span>-filter<span class="o">=</span><span class="s1">&#39;Priority (required) | Priority (important) | Priority (standard) | nginx | postgresql&#39;</span><span class="w"> </span>-filter-with-deps<span class="w"> </span>bullseye-main
</code></pre></div>

<h3 id="34-updatesynchronize-the-mirror">3.4 Update(Synchronize) the mirror<a class="headerlink" href="#34-updatesynchronize-the-mirror" title="Permanent link">&para;</a></h3>
<p>Now we are ready to synchronize the local mirror with the official repo. </p>
<blockquote>
<p>The doc and command aptly called it update, I found this is ambigue, so I use the word synchronize.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="c1"># this command will download all the filtered package to local server</span>
<span class="c1"># in ~/.aptly/pool/</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>bullseye-main

<span class="c1"># you should see below output</span>
Downloading<span class="w"> </span>http://ftp.fr.debian.org/debian/dists/bullseye/InRelease...
Success<span class="w"> </span>downloading<span class="w"> </span>http://ftp.fr.debian.org/debian/dists/bullseye/InRelease
gpgv:<span class="w"> </span>can<span class="s1">&#39;t allocate lock for &#39;</span>/home/coder/.gnupg/trustedkeys.gpg<span class="err">&#39;</span>
gpgv:<span class="w"> </span>Signature<span class="w"> </span>made<span class="w"> </span>Sat<span class="w"> </span><span class="m">17</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">10</span>:15:20<span class="w"> </span>AM<span class="w"> </span>UTC
gpgv:<span class="w">                </span>using<span class="w"> </span>RSA<span class="w"> </span>key<span class="w"> </span>0146DC6D4A0B2914BDED34DB648ACFD622F3D138
gpgv:<span class="w"> </span>Good<span class="w"> </span>signature<span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;Debian Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;&quot;</span>
gpgv:<span class="w"> </span>Signature<span class="w"> </span>made<span class="w"> </span>Sat<span class="w"> </span><span class="m">17</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">10</span>:15:21<span class="w"> </span>AM<span class="w"> </span>UTC
gpgv:<span class="w">                </span>using<span class="w"> </span>RSA<span class="w"> </span>key<span class="w"> </span>A7236886F3CCCAAD148A27F80E98404D386FA1D9
gpgv:<span class="w"> </span>Good<span class="w"> </span>signature<span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;Debian Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;&quot;</span>
gpgv:<span class="w"> </span>Signature<span class="w"> </span>made<span class="w"> </span>Sat<span class="w"> </span><span class="m">17</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">10</span>:20:04<span class="w"> </span>AM<span class="w"> </span>UTC
gpgv:<span class="w">                </span>using<span class="w"> </span>RSA<span class="w"> </span>key<span class="w"> </span>A4285295FC7B1A81600062A9605C66F00D6C9793
gpgv:<span class="w">                </span>issuer<span class="w"> </span><span class="s2">&quot;debian-release@lists.debian.org&quot;</span>
gpgv:<span class="w"> </span>Good<span class="w"> </span>signature<span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;Debian Stable Release Key (11/bullseye) &lt;debian-release@lists.debian.org&gt;&quot;</span>
Downloading<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>parsing<span class="w"> </span>package<span class="w"> </span>files...
Downloading<span class="w"> </span>http://ftp.fr.debian.org/debian/dists/bullseye/main/binary-amd64/Packages.gz...
Success<span class="w"> </span>downloading<span class="w"> </span>http://ftp.fr.debian.org/debian/dists/bullseye/main/binary-amd64/Packages.gz
Applying<span class="w"> </span>filter...
Packages<span class="w"> </span>filtered:<span class="w"> </span><span class="m">58640</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">325</span>.
Building<span class="w"> </span>download<span class="w"> </span>queue...
Download<span class="w"> </span>queue:<span class="w"> </span><span class="m">325</span><span class="w"> </span>items<span class="w"> </span><span class="o">(</span><span class="m">168</span>.48<span class="w"> </span>MiB<span class="o">)</span>
</code></pre></div>

<p>Current mirror contents are stored in the package database. You can update mirror at any moment as required.</p>
<h2 id="4-use-snapshots">4 Use snapshots<a class="headerlink" href="#4-use-snapshots" title="Permanent link">&para;</a></h2>
<p>As you know, the package in the official repo can be updated anytime, but our mirror can't synchronize each modification in real time. We can use snapshot to release packages in a state  </p>
<h3 id="41-create-snapshots">4.1 Create snapshots<a class="headerlink" href="#41-create-snapshots" title="Permanent link">&para;</a></h3>
<p>Its time take snapshots of the mirrors to preserve <code>exact current mirror state</code>. I will label snapshots after mirror name, applying version for the main <strong>bullseye</strong> mirror (i.e. Debian 11.6 -&gt; bullseye ) and current date for frequently updated <code>security</code> and <code>updates</code> mirrors:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># the general form</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>&lt;snapshot-name&gt;<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span>&lt;mirror-name&gt;

<span class="c1"># if you don&#39;t know the existing mirror name, use below command to get all available mirrors</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>list

<span class="c1"># create a snapshot for mirror bullseye-main</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>bullseye-main-11.6<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span>bullseye-main

<span class="c1"># create a snapshot for mirror bullseye-updates</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>bullseye-updates-20230206<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span>bullseye-updates

<span class="c1"># create a snapshot for bullseye-security</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>bullseye-security-20230206<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span>bullseye-security
</code></pre></div>

<h3 id="42-merging-snapshots">4.2 Merging snapshots<a class="headerlink" href="#42-merging-snapshots" title="Permanent link">&para;</a></h3>
<p>Releasing the snapshop one by one is not very productive. We can merge the three snapshoot into one by using below command.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># general form</span>
<span class="c1"># -latest option chooses merge strategy: package with latest version wins.</span>
<span class="c1"># it can take as many sub snapshot as possible</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>merge<span class="w"> </span>-latest<span class="w"> </span>&lt;snapshot-name&gt;<span class="w"> </span>&lt;sub-snapshot-name1&gt;<span class="w"> </span>&lt;sub-snapshot-name2&gt;<span class="w"> </span>...

<span class="c1"># if you don&#39;t know your snapshot name, you can use below command to get them</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>list

<span class="c1"># our example</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>merge<span class="w"> </span>-latest<span class="w"> </span>bullseye-stable-20230206<span class="w"> </span>bullseye-main-11.6<span class="w"> </span>bullseye-security-20230206<span class="w"> </span>bullseye-updates-20230206
</code></pre></div>

<p>Let's check the merged snapshot, for example the latest version of package nginx should came from the security mirror, because the there is a security update latly. </p>
<p>We can use below command to track the package origin</p>
<div class="codehilite"><pre><span></span><code>aptly<span class="w"> </span>package<span class="w"> </span>show<span class="w"> </span>-with-references<span class="w"> </span><span class="s1">&#39;Name (nginx)&#39;</span>

<span class="c1"># you should see below output</span>
Package:<span class="w"> </span>nginx
Priority:<span class="w"> </span>optional
Section:<span class="w"> </span>httpd
Installed-Size:<span class="w"> </span><span class="m">102</span>
Maintainer:<span class="w"> </span>Debian<span class="w"> </span>Nginx<span class="w"> </span>Maintainers<span class="w"> </span>&lt;pkg-nginx-maintainers@alioth-lists.debian.net&gt;
Architecture:<span class="w"> </span>all
Version:<span class="w"> </span><span class="m">1</span>.18.0-6.1+deb11u3
Depends:<span class="w"> </span>nginx-core<span class="w"> </span><span class="o">(</span><span class="s">&lt;&lt; 1.1</span><span class="m">8</span>.0-6.1+deb11u3.1~<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>nginx-full<span class="w"> </span><span class="o">(</span><span class="s">&lt;&lt; 1.1</span><span class="m">8</span>.0-6.1+deb11u3.1~<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>nginx-light<span class="w"> </span><span class="o">(</span><span class="s">&lt;&lt; 1.1</span><span class="m">8</span>.0-6.1+deb11u3.1~<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>nginx-extras<span class="w"> </span><span class="o">(</span><span class="s">&lt;&lt; 1.1</span><span class="m">8</span>.0-6.1+deb11u3.1~<span class="o">)</span>,<span class="w"> </span>nginx-core<span class="w"> </span><span class="o">(</span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1</span>.18.0-6.1+deb11u3<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>nginx-full<span class="w"> </span><span class="o">(</span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1</span>.18.0-6.1+deb11u3<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>nginx-light<span class="w"> </span><span class="o">(</span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1</span>.18.0-6.1+deb11u3<span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>nginx-extras<span class="w"> </span><span class="o">(</span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1</span>.18.0-6.1+deb11u3<span class="o">)</span>
Filename:<span class="w"> </span>nginx_1.18.0-6.1+deb11u3_all.deb
Size:<span class="w"> </span><span class="m">92936</span>
MD5sum:<span class="w"> </span>47deabf24cd33a9440782b61f30bc2e9
SHA1:<span class="w"> </span>320d46db1c47ef6f7ccc1c7d3685403615127b33
SHA256:<span class="w"> </span>795f27bbd556a60e132e6f779b78105969009d129e727ab60f826e1bf4320365
SHA512:<span class="w"> </span>47e69866c8e829f60b05d7074c28c89a21c09a3d3e6527192882f2c1f63abfafd8a3ee2f45ab1bb381508eb7f17e5663656b05da4efdfdb3ed129c467aa112ca
Description:<span class="w"> </span>small,<span class="w"> </span>powerful,<span class="w"> </span>scalable<span class="w"> </span>web/proxy<span class="w"> </span>server
Description-Md5:<span class="w"> </span>902443ddbee17249123a068e7ca7c6d8
Homepage:<span class="w"> </span>https://nginx.net

References<span class="w"> </span>to<span class="w"> </span>package:
<span class="w">  </span>mirror<span class="w"> </span><span class="o">[</span>bullseye-security<span class="o">]</span>:<span class="w"> </span>http://security.debian.org/debian-security/<span class="w"> </span>bullseye-security/updates
<span class="w">  </span>mirror<span class="w"> </span><span class="o">[</span>bullseye-main<span class="o">]</span>:<span class="w"> </span>http://ftp.fr.debian.org/debian/<span class="w"> </span>bullseye
<span class="w">  </span>snapshot<span class="w"> </span><span class="o">[</span>bullseye-main-11.6<span class="o">]</span>:<span class="w"> </span>Snapshot<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span><span class="o">[</span>bullseye-main<span class="o">]</span>:<span class="w"> </span>http://ftp.fr.debian.org/debian/<span class="w"> </span>bullseye
<span class="w">  </span>snapshot<span class="w"> </span><span class="o">[</span>bullseye-stable-20230206<span class="o">]</span>:<span class="w"> </span>Merged<span class="w"> </span>from<span class="w"> </span>sources:<span class="w"> </span><span class="s1">&#39;bullseye-main-11.6&#39;</span>,<span class="w"> </span><span class="s1">&#39;bullseye-security-20230206&#39;</span>,<span class="w"> </span><span class="s1">&#39;bullseye-updates-20230206&#39;</span>
<span class="w">  </span>snapshot<span class="w"> </span><span class="o">[</span>bullseye-security-20230206<span class="o">]</span>:<span class="w"> </span>Snapshot<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span><span class="o">[</span>bullseye-security<span class="o">]</span>:<span class="w"> </span>http://security.debian.org/debian-security/<span class="w"> </span>bullseye-security/updates
</code></pre></div>

<blockquote>
<p>in the <code>references to package</code> block, you can notice the package origin is from snapshot <code>bullseye-security-20230206</code> (last row). </p>
</blockquote>
<h2 id="5-publish-repository">5 Publish Repository<a class="headerlink" href="#5-publish-repository" title="Permanent link">&para;</a></h2>
<p>Now we can publish our snapshot <code>bullseye-stable-20230206</code> as <strong>Debian repository</strong>, which will be consumed by <strong>apt-get</strong> client.</p>
<p>Use below command to publish the snapshot</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># general form</span>
<span class="c1"># the -distribution option: specifies the distribution name of the repo, which is mandatory</span>
aptly<span class="w"> </span>publish<span class="w"> </span>snapshot<span class="w"> </span>-distribution<span class="o">=</span>&lt;distribution-name&gt;<span class="w"> </span>&lt;snapshot-name&gt;


<span class="c1"># our example</span>
aptly<span class="w"> </span>publish<span class="w"> </span>snapshot<span class="w"> </span>-distribution<span class="o">=</span>bullseye<span class="w"> </span>bullseye-stable-20230206
</code></pre></div>

<blockquote>
<p>The above command will publish the repository to <code>~/.aptly/public/</code> directory. You can start <strong>any HTTP server to serve this directory as static files</strong>, or use aptly built-in webserver for testing.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="c1"># run aptly built-in webserver (for testing only, not recommended for prod)</span>
aptly<span class="w"> </span>serve
</code></pre></div>

<h3 id="51-check-published-snapshot-dependencies">5.1 Check published snapshot dependencies<a class="headerlink" href="#51-check-published-snapshot-dependencies" title="Permanent link">&para;</a></h3>
<p>Below command will generate a graph which shows the dependencies of the published snapshot</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># this command requires graphviz</span>
<span class="c1"># -output=&quot;&quot;: specify output filename, default is to open result in viewer</span>
<span class="c1"># -format=&quot;png&quot;: graph output format, could be anything graphviz supports, e.g. png, pdf, svg, </span>
aptly<span class="w"> </span>graph<span class="w"> </span>-output<span class="o">=</span><span class="s2">&quot;/tmp/package_build_history.png&quot;</span><span class="w"> </span>-format<span class="o">=</span><span class="s2">&quot;png&quot;</span>

<span class="c1"># install graphviz</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>graphviz
</code></pre></div>

<h3 id="52-serve-the-published-via-a-web-server">5.2 Serve the published via a web server<a class="headerlink" href="#52-serve-the-published-via-a-web-server" title="Permanent link">&para;</a></h3>
<p>For testing purpose, the built-in webserver is enough. But For production, we need to install a real webserver. In this tutorial, we recommend <strong>nginx</strong>, because it has better performence for service static content and consum less resources compare to <strong>Apache2</strong>.</p>
<p>You can check this <a href="../nginx/03.Install_Nginx_as_reverse_proxy.md">tutorial</a> to install nginx</p>
<p>After the installation of nginx, you need to create a virtual host. To do so, create a <code>conf file</code> under <strong>/etc/nginx/sites-available/</strong>. In our tutorial, I named the conf file as <strong>deb-repo.conf</strong></p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>vim<span class="w"> </span>/etc/nginx/sites-available/deb-repo.conf

<span class="c1"># add below content in it</span>
<span class="c1"># you need to modify the server name and the root path </span>
server<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>server_name<span class="w"> </span>deb.casd.local<span class="p">;</span>

<span class="w">    </span>root<span class="w"> </span>/package-repo/aptly/.aptly/public<span class="p">;</span>

<span class="w">    </span>location<span class="w"> </span>/<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>autoindex<span class="w"> </span>on<span class="p">;</span>
<span class="w">        </span>try_files<span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri</span>/<span class="w"> </span><span class="o">=</span><span class="m">404</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="c1"># check the correctness of your conf syntax</span>
sudo<span class="w"> </span>nginx<span class="w"> </span>-t
</code></pre></div>

<p>To enable this conf, you need to create a sym link in <strong>/etc/nginx/sites-enabled/</strong> </p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/deb-repo.conf<span class="w"> </span>/etc/nginx/sites-enabled/

<span class="c1"># you may need to restart the nginx server</span>

sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx
</code></pre></div>

<blockquote>
<p>We do not recommend to add ssl to transfer http to https. Because the server identity and package integrity is ensured by the apt GPG protocol. And the package is public data, no need to ensure confidentiality. The ssl will only add some performence overhead without any utility.</p>
</blockquote>
<h2 id="6-using-the-private-repository">6. Using the private Repository<a class="headerlink" href="#6-using-the-private-repository" title="Permanent link">&para;</a></h2>
<h3 id="61-prepare-the-gpg-gnu-privacy-guard-key">6.1 Prepare the GPG (GNU privacy guard) key<a class="headerlink" href="#61-prepare-the-gpg-gnu-privacy-guard-key" title="Permanent link">&para;</a></h3>
<p>First I need to <strong>import public part of the GPG key</strong> that was used to sign the repository into trusted apt keyring on target machine.</p>
<blockquote>
<p>The file extenion <strong>.asc</strong> indicates this public key is ASCII armored key. The extension <strong>.gpg</strong> indicates the key is in <code>binary OpenPGP format</code>. It is very important for the clients when they import the key as trusted gpg key into their key store. </p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="c1"># run from the server which has aptly </span>
gpg<span class="w"> </span>--export<span class="w"> </span>--armor<span class="w"> </span>&gt;<span class="w"> </span>repo_gpg_key.asc

<span class="c1"># the generated file should look like this</span>
-----BEGIN<span class="w"> </span>PGP<span class="w"> </span>PUBLIC<span class="w"> </span>KEY<span class="w"> </span>BLOCK-----

mQGNBGPX2GABDACnY9HpMwewenBppirK3vZ4/JiKtzevZCwDMlx6OjKGcnfDKMVU
/jWWoncIgZ3TxH8nEy3AgV109wy9ztX5kBa1IUgwdnLwpWepvGIKlWCCk9g2dEOM
VJFlNcyl3pVUxbjov7jvcx/epB/79RO8IkRjjtLhDbiH5Wh07+gSfbIdDNXqT7av
bnt1ZJNOo7+zRVJ5bgxbEF0q+sp4ESUtIxD8wfgV6N3dlzIgrA5IgLS4qt/0OWoC
IdSf9Kq5LD+FXYJ9Q0WrbDC4G0zBQuYLf/eaAMkPnGBDTHLSWdGXL02jQQdZb9bq
H/Zdunm+akngiOc1vAozXMECtZMVvdZ0GopJldZ0oofVRVSiRSimctpGlQ95BGU8
+/cDV174mtTvnw5RIsi9lsyif/ab11mt+dthJFt4/wcppEEhMLKqF/UTTshpSnes
GAsEabdlv9kJu2gwJ79ftUgBDdbFp9d4unJoo2ui4ejuyJi1CXQdcKFaTIWRNolu
cRWFdlJWvmKi++0AEQEAAbQiY2FzZC1vbnl4aWEgPGNhc2Qtc3VwcG9ydEBjYXNk
LmV1PokB1AQTAQoAPhYhBF4/+09JAtKGdNdhUtXMNPl62Y49BQJj19hgAhsDBQkD
wmcABQsJCAcCBhUKCQgLAgQWAgMBAh4BAheAAAoJENXMNPl62Y49I1IL/Rs0lmsu
LktQ3fEwGjFYTBtU4a659Fb4QG6l65msiRtLH3jKOdng3B/CwRE71yzbv3MgQntF
Myp7PKQhdD32hTKM0d8n8Fbj05qkq+SjoRmhnKH8gVpUv+fduEORSMpGqCYh+EI2
9pw9Vkl5BWZFrx7KuXzatBShA1ZAF1v+kIRe8fFtr63laoyKhxM3rvtHJk/wFQe2
b8Vy2ZyI1ez48WjoYJTo/S9VeX6x46FcA4KEvAbxcO2XcmOdQqmGl7d234HpYOns
UDM/bmwqJgV+4J4Dq2a4WSkpObMUIMns99mTFCCJ6J43YftjMZ12AFjxmAgMx5g4
FbdAsFhtD3WXsHcAMrbjbEdom00LiCkCBSzrHrPoT+mFM7D4tX7tbKKBg7oV+na7
fICb5eIfqpAQaHjLlVelWS4K4vLT7LSDAgJH0WrjtOiz1idZK6Gv6DBLc0lOmimB
xmcpVoHCEWs7RScjaMNnDdJsUx7yGA081AHsoo5Xaig1C37N9SYCBFMAELkBjQRj
19hgAQwAqZ1LN0bjGGGaQq9Cgvffa+ROP75Ss0KjET1w++Ng2MkmxZCWdLv84qp9
u6MEM6wxtL3wKi2Vwk5QGvfVi5AvOgRo0D15CtI8JKDZlnVGYiJ9f5Xl1aKubV0t
ZJSM2yb/J5vg/MJ2TTKHYeNgnvFANkWrDeyhxCEfh6qUcY1nTuxkbmVTpw4YAFpI
5WQuqtuI/94tJ6kd5P5AWCuVrZ88/Je43EGUhfaAA9353oHsz+r12FH1Bj1V+B9X
dOSxemTZdb9zkpcKtlXSiGwfJWaPXABJmcKZ3T1LIRC0dunTLaEeoN7AlfQEuU5c
prsi35SPBoo0sIKgUgzqGN7L89fBx2yQ4kHSzmhQUSI/F9sqdkMHxKWddyM+qX8O
8uBILun+SG76NVZRoC+u3DsSwkfdvpVq/SOEOIaVWlWLj1yVIf7/aP1fYLCWs8B4
x1YuMuDd36mswOINjceC+n0Khewfc9iB6VO/CZaKfoC2BegbMtsQ3FX010rPKgb5
gIHIwleNABEBAAGJAbwEGAEKACYWIQReP/tPSQLShnTXYVLVzDT5etmOPQUCY9fY
YAIbDAUJA8JnAAAKCRDVzDT5etmOPUYsC/9x/qfOQamOlB/ShmrajEDCB7KaR3/n
Lb8ihC9GDXx0wJVEshpd9F3mQN+0/P05hRVj6AXJNHfyu0WcBjqtP1YCQKycK9FM
I3xhvWsfzQQihw0r+a2DjXF4zWZwO9bQincbypHGNzDpiKC2FCR+Ciuijqm9EhIP
knqbSvPHMQzuxiFdr+jVF+jpq3TEKeGVZzBIJhQJZzCrRjTn3op65nqcoGodJgOg
vO4tHEHHeEG9ws9PR1L8FUO362C9/5xs/CziN6UppBN1U7MjLTuMMk2DLnCX8Q4N
/fV3q/MbYYCHyzVCoaOoZuCHl+uN4cbS3JulnZjEC9XPtUtQgVpIS3Xpak+c8Vku
F5+rdWftPzc53+DgFqOVHO1gci2B6Xpc6pMzaQ7UJF1SxZQid0VbsmBK88K41oQz
Jzfk329lUq4D5cYFt//hJ2Fk6CS3AHkyrV2zGoZZ65BZ8OnYIavjGs2A7FOYZxo6
AvQWBa75d4ySlyqQHh9wHJ0V5Ba7X/kePzM<span class="o">=</span>
<span class="o">=</span>s9av
-----END<span class="w"> </span>PGP<span class="w"> </span>PUBLIC<span class="w"> </span>KEY<span class="w"> </span>BLOCK-----
</code></pre></div>

<h3 id="62-copy-the-public-key-to-target-machine">6.2 Copy the public key to target machine<a class="headerlink" href="#62-copy-the-public-key-to-target-machine" title="Permanent link">&para;</a></h3>
<p>There are two solutions for adding the the gpg key of the private repo:
Solution 1 : Use <code>apt-key</code> tool
Solution 2 : Without tool</p>
<h4 id="solution-1">Solution 1:<a class="headerlink" href="#solution-1" title="Permanent link">&para;</a></h4>
<p>This solution is <code>deprecated</code>, so we don't recommend this solution.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># down the public key from the deb server</span>
wget<span class="w"> </span>http://deb.casd.local/casd_gpg_key.asc

<span class="c1"># apt-key requires gnupg package, if you don&#39;t have it you need to install it</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gnupg<span class="w"> </span>

<span class="c1"># run from the target server which consume apt repository</span>
<span class="c1"># add our GPG as trusted key</span>
sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>casd_gpg_key.asc
</code></pre></div>

<h4 id="solution-2">Solution 2:<a class="headerlink" href="#solution-2" title="Permanent link">&para;</a></h4>
<p>We recommand this solution, and the client does not need to install any extra package.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># download the key and add it to the key store</span>
<span class="c1"># -q activate quiet mode to hide output</span>
<span class="c1"># -O- means output to std out.</span>
wget<span class="w"> </span>-qO-<span class="w"> </span>http://deb.casd.local/casd_gpg_key.asc<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/trusted.gpg.d/casd_gpg_key.asc
</code></pre></div>

<h4 id="change-apt-source-repo-list">Change apt source repo list<a class="headerlink" href="#change-apt-source-repo-list" title="Permanent link">&para;</a></h4>
<p>Now we need to edit the <code>/etc/apt/sources.list</code> file and add our repo as a source repo. Here suppose our repo server url is <code>http://deb.casd.local</code>, your source.list should look like below file </p>
<div class="codehilite"><pre><span></span><code># comment the default sources
# deb http://deb.debian.org/debian bullseye main
# deb http://security.debian.org/debian-security bullseye-security main
# deb http://deb.debian.org/debian bullseye-updates main

# add our repo
deb http://deb.casd.local/ bullseye main
</code></pre></div>

<p>Save and exit, then you need to update the <code>apt-get</code> repo cache</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># update repo cache</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update

<span class="c1"># update the installed packages</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>upgrade
</code></pre></div>

<p>As this repository has been published from snapshot, <code>it would never change until it is update to new snapshot</code>. Good thing is that I can setup all my machine to use this repo and get identical set of packages installed. Bad thing is that I need to maintain and update my repo as updates are coming, but if I have many machines, the advantage of predictable upgrades outweighs the maintenance costs.</p>
<h2 id="7-upgrading-repository">7. Upgrading repository<a class="headerlink" href="#7-upgrading-repository" title="Permanent link">&para;</a></h2>
<p>Several days after you published your repository, when you update your mirrors again. And you discover there are new security updates. You need to follow below steps to build a new release </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># update mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>bullseye-main
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>bullseye-updates
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>bullseye-security<span class="w"> </span>

<span class="c1"># create new snapshot</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>bullseye-main-11.6<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span>bullseye-main
aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>bullseye-updates-&lt;date&gt;<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span>bullseye-updates
aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span>bullseye-security-&lt;date&gt;<span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span>bullseye-security

<span class="c1"># merge the snapshot</span>
aptly<span class="w"> </span>snapshot<span class="w"> </span>merge<span class="w"> </span>-latest<span class="w"> </span>bullseye-stable-&lt;date&gt;<span class="w"> </span>bullseye-main-11.6<span class="w"> </span>bullseye-updates-&lt;date&gt;<span class="w"> </span>bullseye-security-&lt;date&gt;<span class="w"> </span>

<span class="c1"># publish the new release</span>
<span class="c1"># when there is already a release in use, you need to add switch to replace the old release</span>
aptly<span class="w"> </span>publish<span class="w"> </span>switch<span class="w"> </span>bullseye<span class="w"> </span>bullseye-stable-&lt;date&gt;

<span class="c1"># generate the build graph</span>
aptly<span class="w"> </span>graph<span class="w"> </span>-output<span class="o">=</span><span class="s2">&quot;/pathToAptly/package_build_history_&lt;date&gt;.png&quot;</span><span class="w"> </span>-format<span class="o">=</span><span class="s2">&quot;png&quot;</span>

<span class="c1"># if you don&#39;t need the old release anymore, you can drop them</span>
aptly<span class="w"> </span>db<span class="w"> </span>cleanup
</code></pre></div>

<h2 id="8-serve-the-packages">8. Serve the packages<a class="headerlink" href="#8-serve-the-packages" title="Permanent link">&para;</a></h2>
<p>Although you can run <code>aptly serve</code> to publish the packages via port <code>8080</code> for test purpose. It's recommended to set up 
a web server such as <strong>Nginx</strong> or <strong>apache2</strong></p>
<h2 id="9-cron">9. Cron<a class="headerlink" href="#9-cron" title="Permanent link">&para;</a></h2>
<p>There is a cron job script which try to update the mirror and provide release.
https://github.com/gvogets/aptly-scripts/blob/master/cronjob</p>
<p>We find the cron job is not adapted for our need. So we right our own cron job scripts:
- A release cron job:  publish aptly snapshots automatically
- A clean cron job :</p>
<h3 id="91-aptly-release-cron-job">9.1 Aptly release cron job<a class="headerlink" href="#91-aptly-release-cron-job" title="Permanent link">&para;</a></h3>
<p>The below cron job <code>aptly_build_release.bash</code> is designed to publish aptly snapshots automatically</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># if we put this script in cron.weekly, this script will be executed with root privilege. And the aptly db data is user specific.</span>
<span class="c1"># So run as root can not get the information about the mirror and snapshoot. So for the aptly command, we need to use sudo -u aptly</span>
<span class="c1"># to run the command as user `aptly`.</span>
<span class="c1"># script config</span>
<span class="nv">uid</span><span class="o">=</span>changeMe
<span class="nv">dist_name</span><span class="o">=</span>bullseye
<span class="nv">root_path</span><span class="o">=</span>/path/to/.aptly
<span class="nv">log_file_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">root_path</span><span class="si">}</span><span class="s2">/log/aptly_log.out&quot;</span>
<span class="nv">gpg_pwd_file_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">root_path</span><span class="si">}</span><span class="s2">/creds/pwd&quot;</span>
<span class="nv">repo_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">root_path</span><span class="si">}</span><span class="s2">/public&quot;</span>
<span class="nv">export_repo_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">root_path</span><span class="si">}</span><span class="s2">/export&quot;</span>
<span class="nv">release_date</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y%m%d&#39;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">snapshot_merge_list</span><span class="o">=()</span>

<span class="c1"># set bash script abort on the first command fails, if </span>
<span class="nb">set</span><span class="w"> </span>-eo<span class="w"> </span>pipefail

<span class="c1"># Saves file descriptors so they can be restored to whatever they were before </span>
<span class="c1">#redirection or used themselves to output to whatever they were before the following redirect.</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="m">4</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="c1"># Restore file descriptors for particular signals. Not generally necessary since they </span>
<span class="c1"># should be restored when the sub-shell exits.</span>
<span class="nb">trap</span><span class="w"> </span><span class="s1">&#39;exec 2&gt;&amp;4 1&gt;&amp;3&#39;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span>
<span class="c1"># Redirect stdout to file log.out then redirect stderr to stdout. Note that the order is </span>
<span class="c1"># important when you want them going to the same file. stdout must be redirected </span>
<span class="c1"># before stderr is redirected to stdout.</span>
<span class="c1"># By default, the log will be appended to the log file. If you only want to keep the log</span>
<span class="c1"># of the last run, replace &gt;&gt; by &gt;</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="s2">&quot;</span><span class="si">${</span><span class="nv">log_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="c1"># Everything below will go to the file &#39;aptly_log.out&#39;:</span>

<span class="c1"># clean the old graph</span>
rm<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">repo_path</span><span class="si">}</span>/*.png

<span class="c1"># clean last release zip symoblic link</span>
rm<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">repo_path</span><span class="si">}</span>/*.zip


<span class="c1"># read the gpg private key password from a file</span>
<span class="nv">gpg_pwd</span><span class="o">=</span><span class="k">$(</span>&lt;<span class="s2">&quot;</span><span class="si">${</span><span class="nv">gpg_pwd_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># update all existing mirror</span>
sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>mirror<span class="w"> </span>list<span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n1<span class="w"> </span>sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>mirror<span class="w"> </span>update


<span class="c1"># create a list of mirror</span>
<span class="nv">REPOS</span><span class="o">=</span><span class="k">$(</span>sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>mirror<span class="w"> </span>list<span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="k">)</span>

<span class="c1"># loop through the mirror list, create new snapshot for each mirror</span>
<span class="c1"># build a snapshot merge list</span>
<span class="k">for</span><span class="w"> </span>REPO<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$REPOS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>snapshot<span class="w"> </span>create<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">REPO</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>from<span class="w"> </span>mirror<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">REPO</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">snapshot_merge_list</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">REPO</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">snapshot_merge_list</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="c1"># merge the snapshot</span>
sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>snapshot<span class="w"> </span>merge<span class="w"> </span>-latest<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">dist_name</span><span class="si">}</span><span class="s2">-stable-</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">snapshot_merge_list</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># publish the new release</span>
<span class="c1"># when there is already a release in use, you need to add switch to replace the old release</span>
<span class="c1"># we need to put -batch=true when run this script in cron, otherwise, aptly and gpg will use the same /dev/tty. And this will cause </span>
<span class="c1"># the -passphrase option fail, and a promt will show up. </span>
sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>publish<span class="w"> </span>switch<span class="w"> </span>-batch<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-passphrase<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">gpg_pwd</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">dist_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">dist_name</span><span class="si">}</span><span class="s2">-stable-</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># generate the build graph</span>
sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>graph<span class="w"> </span>-output<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">repo_path</span><span class="si">}</span><span class="s2">/package_build_history_</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="w"> </span>-format<span class="o">=</span><span class="s2">&quot;png&quot;</span>

<span class="c1"># if you don&#39;t need the old release anymore, you can drop them</span>
sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>db<span class="w"> </span>cleanup

<span class="c1"># zip the release and put it to the export repo</span>
sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>zip<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">export_repo_path</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">dist_name</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">repo_path</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># create a symbolic link</span>
sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">export_repo_path</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">dist_name</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">repo_path</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">dist_name</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">release_date</span><span class="si">}</span><span class="s2">.zip&quot;</span>
</code></pre></div>

<h4 id="911-script-configuration">9.1.1 Script configuration<a class="headerlink" href="#911-script-configuration" title="Permanent link">&para;</a></h4>
<p>The first section of this script is the configuration. </p>
<ul>
<li><strong>uid</strong>: The uid of the user which you want to run the aptly script</li>
<li><strong>dist_name</strong>: The name of the Debian distribution which you want to publish</li>
<li><strong>root_path</strong>: The root folder path of the aptly app. This path will be different if you follow an other installation guide. If you follow my guide. It should be located at <code>~/.aptly</code>. By default, it should contain three folders <code>db</code>, <code>pool</code> and <code>public</code>. To make the corn script work, you must create three new folders(i.e. <code>log</code>, <code>creds</code>, and <code>public</code>) under the root_path.</li>
<li><strong>log_file_path</strong>: The path of the log file of the cron job</li>
<li><strong>gpg_pwd_file_path</strong>: The path of the file which contains the password of the GPG private key</li>
<li><strong>repo_path</strong>: This folder will host the source of the deb package, and it will be used by the webserver to publish the package</li>
<li><strong>export_repo_path</strong>: This folder contains the zip file of all the publish deb packages. Each zip file can be used as an export of a release.  </li>
</ul>
<p>The aptly root path folder should have the following shape:</p>
<div class="codehilite"><pre><span></span><code>.aptly/
 creds
 db
 export
 log
 pool
 public
</code></pre></div>

<ul>
<li>In <strong>creds</strong> folder, it contains the passphrase of the GPG private key. This key is used to sign all the packages that are published by you. The default file name is <code>pwd</code>. If you change the file name, you need to change the config too in the cron script.</li>
<li>In <strong>db</strong> folder, it contains the database of the aptly which stores the state of the aptly (e.g. mirror list, snapshot list, published package list, etc.)</li>
<li>In <strong>export</strong> folder, it contains a zip file of all published packages. This zip file can be copied and deployed on another web server. The web server can act as a deb repo afterward.</li>
<li>In <strong>log</strong> folder, it contains a log file of the cron script execution</li>
<li>In <strong>pool</strong> folder, it contains all the packages of the available mirrors</li>
<li>In <strong>public</strong> folder, it contains all the publish packages of the current deb repo.</li>
</ul>
<h4 id="912-handling-new-emerging-mirrors">9.1.2 Handling New emerging mirrors<a class="headerlink" href="#912-handling-new-emerging-mirrors" title="Permanent link">&para;</a></h4>
<p>By default, the script will consider all mirrors available in the aptly, update it, create a snapshot, build a merge 
of all snapshots and publish the merged snapshot.</p>
<p>If you want to add a new mirror and enable the mirror update via the corn job,  you only need to create a mirror and 
update the mirror. <strong>You don't need to modify the above script</strong></p>
<p>For example, we want to add two more mirrors:
  - docker: 
  - k8s</p>
<h5 id="create-mirror-for-k8s">Create Mirror for k8s<a class="headerlink" href="#create-mirror-for-k8s" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="c1"># add gpg key of k8s repo as trusted key</span>
gpg<span class="w"> </span>--no-default-keyring<span class="w"> </span>--keyring<span class="w"> </span>trustedkeys.gpg<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>B53DC80D13EDEF05

<span class="c1"># create mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>k8s-main<span class="w">  </span>http://apt.kubernetes.io/<span class="w"> </span>kubernetes-xenial<span class="w"> </span>main

<span class="c1"># update mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>k8s-main
</code></pre></div>

<h5 id="create-mirror-for-docker">Create Mirror for docker<a class="headerlink" href="#create-mirror-for-docker" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="c1"># add gpg key for the containerd.io repo</span>
gpg<span class="w"> </span>--no-default-keyring<span class="w"> </span>--keyring<span class="w"> </span>trustedkeys.gpg<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>7EA0A9C3F273FCD8

<span class="c1"># create mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>docker-main<span class="w"> </span>http://download.docker.com/linux/debian/<span class="w"> </span>bullseye<span class="w"> </span>stable

<span class="c1"># update mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>docker-main
</code></pre></div>

<h3 id="92-cron-job-for-cleaning-old-release">9.2 Cron job for cleaning old release<a class="headerlink" href="#92-cron-job-for-cleaning-old-release" title="Permanent link">&para;</a></h3>
<p>The snapshot and the generated zip files will not be cleaned automatically. As a result, every week we will have at least 4 more snapshot in the db and a zip file which cost 100GB. So we need to clean them at a point to make the db clean and save some disk spaces. Two solution is possible:</p>
<ul>
<li>Add a task in the current cron job, and clean the old snapshots after publishing a new snapshot. Pros: The aptly db only contains currently published snapshots, so db is very clean. Cons: All history snapshots are removed. So unable to rollback in case of  problems.</li>
<li>Create a new cronjob that cleans the snapshot. Pros: Can have a different run policy. So we can run it monthly, and we keep 4 weekly snapshots for rollback when needed.</li>
</ul>
<p>For now, I choose to use solution 2. The below cron job <code>clean_snapshot.bash</code> which cleans the snapshot</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># script config, you can change the days to set the snapshot interval</span>
<span class="nv">days</span><span class="o">=</span><span class="m">30</span>
<span class="c1"># you need to change this value to the uid who install aptly</span>
<span class="nv">uid</span><span class="o">=</span>changeMe
<span class="nv">root_path</span><span class="o">=</span>/path/to/.aptly
<span class="nv">log_file_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">root_path</span><span class="si">}</span><span class="s2">/log/aptly_log.out&quot;</span>
<span class="nv">export_repo_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">root_path</span><span class="si">}</span><span class="s2">/export&quot;</span>


<span class="nv">day_in_sec</span><span class="o">=</span><span class="m">86400</span>
<span class="nv">interval</span><span class="o">=</span><span class="k">$((</span><span class="nv">days</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">day_in_sec</span><span class="k">))</span>

<span class="c1"># setup log </span>

<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="m">4</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="nb">trap</span><span class="w"> </span><span class="s1">&#39;exec 2&gt;&amp;4 1&gt;&amp;3&#39;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span>
<span class="c1"># By default, the log will be appended to the log file. If you only want to keep the log</span>
<span class="c1"># of the last run, replace &gt;&gt; by &gt;</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="s2">&quot;</span><span class="si">${</span><span class="nv">log_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="c1"># get the list of the snapshot</span>
<span class="nv">SNAP_SHOTS</span><span class="o">=</span><span class="k">$(</span>sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>snapshot<span class="w"> </span>list<span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="k">)</span>

<span class="c1"># for each snapshot check if it is older than the given day or not. If yes, then delete</span>
<span class="k">for</span><span class="w"> </span>SNAP<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$SNAP_SHOTS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Examing the snapshot: </span><span class="nv">$SNAP</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="c1"># delete the longest match of pattern &quot;-&quot; from the beginning</span>
<span class="w">   </span><span class="nv">release_date</span><span class="o">=</span><span class="si">${</span><span class="nv">SNAP</span><span class="p">##*-</span><span class="si">}</span>
<span class="w">   </span><span class="c1"># convert the string date to the numeric timestamp, here we choose %s (seconde) as prcision. </span>
<span class="w">   </span><span class="c1"># It can be %m (month), %d (day)</span>
<span class="w">   </span><span class="c1"># current date timestamp</span>
<span class="w">   </span><span class="nv">cd_timestamp</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>--date<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$date</span><span class="s2">&quot;</span><span class="w"> </span>+<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="w">   </span><span class="c1"># release date timestamp</span>
<span class="w">   </span><span class="nv">rd_timestamp</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>--date<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$release_date</span><span class="s2">&quot;</span><span class="w"> </span>+<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="w">   </span><span class="c1"># get the expected timestamp</span>
<span class="w">   </span><span class="nv">expected_timestamp</span><span class="o">=</span><span class="k">$((</span><span class="nv">cd_timestamp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">interval</span><span class="k">))</span>
<span class="w">   </span><span class="c1"># compare it</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$rd_timestamp</span><span class="w"> </span>-lt<span class="w"> </span><span class="nv">$expected_timestamp</span><span class="w"> </span><span class="o">]</span>
<span class="w">   </span><span class="k">then</span>
<span class="w">      </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;INFO: snapshot </span><span class="nv">$SNAP</span><span class="s2"> is older than </span><span class="nv">$days</span><span class="s2"> days&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">      </span>sudo<span class="w"> </span>-u<span class="w"> </span><span class="nv">$uid</span><span class="w"> </span>aptly<span class="w"> </span>snapshot<span class="w"> </span>drop<span class="w"> </span>-force<span class="w"> </span><span class="nv">$SNAP</span>
<span class="w">   </span><span class="k">fi</span>
<span class="k">done</span>

<span class="c1"># clean the zip file older than the given day</span>
find<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">export_repo_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.zip&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>+<span class="s2">&quot;</span><span class="si">${</span><span class="nv">days</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-delete
</code></pre></div>

<h2 id="extra-repo-mirror-for-k8s">Extra repo mirror for k8s<a class="headerlink" href="#extra-repo-mirror-for-k8s" title="Permanent link">&para;</a></h2>
<h3 id="k8s-main">k8s-main<a class="headerlink" href="#k8s-main" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># add gpg key of k8s repo as trusted key</span>
gpg<span class="w"> </span>--no-default-keyring<span class="w"> </span>--keyring<span class="w"> </span>trustedkeys.gpg<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>B53DC80D13EDEF05

<span class="c1"># create mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>k8s-main<span class="w">  </span>http://apt.kubernetes.io/<span class="w"> </span>kubernetes-xenial<span class="w"> </span>main

<span class="c1"># update mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>k8s-main
</code></pre></div>

<h3 id="containerdio">containerd.io<a class="headerlink" href="#containerdio" title="Permanent link">&para;</a></h3>
<p>This mirror contains the packages of containerd (container runtime). </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># add gpg key for the containerd.io repo</span>
gpg<span class="w"> </span>--no-default-keyring<span class="w"> </span>--keyring<span class="w"> </span>trustedkeys.gpg<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>7EA0A9C3F273FCD8

<span class="c1"># create mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-architectures<span class="o">=</span>amd64<span class="w"> </span>docker-main<span class="w"> </span>http://download.docker.com/linux/debian/<span class="w"> </span>bullseye<span class="w"> </span>stable

<span class="c1"># update mirror</span>
aptly<span class="w"> </span>mirror<span class="w"> </span>update<span class="w"> </span>docker-main
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.instant", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>